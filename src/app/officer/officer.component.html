
<!-- <Top Navigation Bar> -->
<nav class="top-nav">
  <div class="brand">
    <a class="navbar-brand d-flex align-items-center" href="">
      <!-- Dummy SVG logo -->
      <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"
           class="bi bi-bank me-2" viewBox="0 0 16 16">
        <path d="M8 .95l6.364 3.182v1.09H1.636v-1.09L8 .95zm0 1.09L2.636 5.223h10.728L8 2.04zM1 6h14v1H1V6zm1 2h1v6H2V8zm2 0h1v6H4V8zm2 0h1v6H6V8zm2 0h1v6H8V8zm2 0h1v6h-1V8zm2 0h1v6h-1V8zm2 0h1v6h-1V8z"/>
      </svg>
      <span class="fw-bold" id="logo-text">MyBank</span>
    </a>
  </div>
 
  <!-- mid nav-bar -->
  <ul class="nav-links">
    <li [class.active]="activeTab === 'create'">
      <button (click)="activeTab='create'">Create Bank Account</button>
    </li>
    <li [class.active]="activeTab === 'update'">
      <button (click)="activeTab='update'">Update Bank Account</button>
    </li>
    <li [class.active]="activeTab === 'history'">
      <button (click)="activeTab='history'">Transaction History</button>
    </li>
  </ul>
 
  <!-- Profile Section -->
  <div class="profile">
  <!-- User SVG icon -->
  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"
       fill="currentColor" class="bi bi-person-circle profile-icon" viewBox="0 0 16 16">
    <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
    <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468
    11.37C3.242 11.226 4.805 10 8 10s4.757 1.226 5.468
    2.37A7 7 0 0 0 8 1z"/>
  </svg>
 
  <!-- User details -->
  <div class="profile-details">
    <span class="profile-name">John Doe</span>
  </div>
</div>
 
</nav>
 <br>

<section class="container">
  <!-- Alerts -->
  <div *ngIf="alert.message" class="alert" [class.error]="alert.type==='error'" [class.success]="alert.type==='success'">
    {{ alert.message }}
    <button class="close" (click)="clearAlert()">×</button>
  </div>

  <!-- CREATE ACCOUNT -->
  <div *ngIf="activeTab==='create'" class="card">
    <h2>Create Bank Account</h2>
    <form [formGroup]="createForm" (ngSubmit)="createAccount()">
      <div class="grid">
        <label>
          Account ID
          <input type="text" formControlName="accountId" placeholder="Enter Account ID" />
        </label>
        <label>
          Customer Name
          <input type="text" formControlName="customerName" placeholder="Enter Customer Name" />
        </label>
        <label>
          Customer ID
          <input type="text" formControlName="customerId" placeholder="Enter Customer ID" />
        </label>
        <label>
          Account Type
          <select formControlName="accountType">
            <option value="SAVINGS">Savings</option>
            <option value="CURRENT">Current</option>
          </select>
        </label>
        <label>
          Balance
          <input type="number" formControlName="balance" min="0" step="0.01" />
        </label>
        <label>
          Status
          <select formControlName="status">
            <option value="ACTIVE">Active</option>
            <option value="CLOSED">Closed</option>
          </select>
        </label>
      </div>

      <div class="actions">
        <button class="primary" type="submit" [disabled]="createForm.invalid">Create Account</button>
        <button type="button" class="secondary" (click)="createForm.reset(defaultCreateForm())">Reset</button>
      </div>

      <div class="helper" *ngIf="createForm.invalid">
        <small>All fields are required. Balance must be ≥ 0.</small>
      </div>
    </form>

    <hr />
    <h3>Existing Accounts ({{ accounts.length }})</h3>
    <div class="table-wrap" *ngIf="accounts.length; else noAccountsCreate">
      <table>
        <thead>
          <tr>
            <th>Account ID</th>
            <th>Customer Name</th>
            <th>Customer ID</th>
            <th>Type</th>
            <th>Status</th>
            <th>Balance</th>
            <th>Opened</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let a of accounts">
            <td>{{ a.accountId }}</td>
            <td>{{ a.customerName }}</td>
            <td>{{ a.customerId }}</td>
            <td>{{ a.accountType }}</td>
            <td>
              <span class="pill" [class.ok]="a.status==='ACTIVE'" [class.bad]="a.status==='CLOSED'">
                {{ a.status }}
              </span>
            </td>
            <td>{{ a.balance | number:'1.2-2' }}</td>
            <td>{{ a.openedAt | date:'medium' }}</td>
            <td>
              <button class="link" (click)="prefillUpdate(a.accountId)">Edit</button>
              <button class="link" (click)="goToHistory(a.accountId)">Txns</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <ng-template #noAccountsCreate>
      <p class="muted">No accounts yet. Create one using the form above.</p>
    </ng-template>
  </div>

  <!-- UPDATE ACCOUNT -->
  <div *ngIf="activeTab==='update'" class="card">
    <h2>Update Bank Account</h2>

    <div class="inline">
      <input class="inline-input" [(ngModel)]="lookupAccountId" placeholder="Enter Account ID" />
      <button class="secondary" (click)="prefillUpdate(lookupAccountId)">Load</button>
    </div>

    <form [formGroup]="updateForm" (ngSubmit)="updateAccount()" *ngIf="updateFormLoaded; else noLoad">
      <div class="grid">
        <label>
          Account ID
          <input type="text" formControlName="accountId" readonly />
        </label>
        <label>
          Customer Name
          <input type="text" formControlName="customerName" />
        </label>
        <label>
          Customer ID
          <input type="text" formControlName="customerId" />
        </label>
        <label>
          Account Type
          <select formControlName="accountType">
            <option value="SAVINGS">Savings</option>
            <option value="CURRENT">Current</option>
          </select>
        </label>
        <label>
          Balance (admin adjustment)
          <input type="number" formControlName="balance" min="0" step="0.01" />
        </label>
        <label>
          Status
          <select formControlName="status">
            <option value="ACTIVE">Active</option>
            <option value="CLOSED">Closed</option>
          </select>
        </label>
      </div>

      <div class="actions">
        <button class="primary" type="submit" [disabled]="updateForm.invalid">Update Account</button>
        <button type="button" class="secondary" (click)="updateForm.reset(); updateFormLoaded=false">Cancel</button>
      </div>
    </form>

    <ng-template #noLoad>
      <p class="muted">Enter an Account ID and click <b>Load</b> to edit.</p>
    </ng-template>

    <hr />
    <h3>Existing Accounts ({{ accounts.length }})</h3>
    <div class="table-wrap" *ngIf="accounts.length; else noAccountsUpdate">
      <table>
        <thead>
          <tr>
            <th>Account ID</th>
            <th>Customer Name</th>
            <th>Customer ID</th>
            <th>Type</th>
            <th>Status</th>
            <th>Balance</th>
            <th>Opened</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let a of accounts">
            <td>{{ a.accountId }}</td>
            <td>{{ a.customerName }}</td>
            <td>{{ a.customerId }}</td>
            <td>{{ a.accountType }}</td>
            <td>
              <span class="pill" [class.ok]="a.status==='ACTIVE'" [class.bad]="a.status==='CLOSED'">
                {{ a.status }}
              </span>
            </td>
            <td>{{ a.balance | number:'1.2-2' }}</td>
            <td>{{ a.openedAt | date:'medium' }}</td>
            <td>
              <!-- Only Edit button in Update tab -->
              <button class="link" (click)="prefillUpdate(a.accountId)">Edit</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <ng-template #noAccountsUpdate>
      <p class="muted">No accounts yet. Create one using the form above.</p>
    </ng-template>
  </div>

  <!-- TRANSACTION HISTORY & RECORD -->
  <div *ngIf="activeTab==='history'" class="card">
    <h2>Transaction History</h2>

    <div class="grid narrow">
      <label>
        Select Account
        <select [(ngModel)]="selectedHistoryAccountId">
          <option [ngValue]="undefined">— Select —</option>
          <option *ngFor="let a of accounts" [ngValue]="a.accountId">
            {{ a.accountId }} — {{ a.customerName }}
          </option>
        </select>
      </label>

      <label>
        High-Value Threshold
        <input type="number" [(ngModel)]="highValueThreshold" min="0" step="1" />
      </label>

      <div class="inline">
        <button class="secondary" (click)="goToCreate()">New Account</button>
        <button class="secondary" (click)="prefillUpdate(selectedHistoryAccountId!)" [disabled]="!selectedHistoryAccountId">
          Edit Account
        </button>
      </div>
    </div>

    <!-- Record Transaction -->
    <div class="card subtle" *ngIf="selectedHistoryAccountId as accId">
      <h3>Record Transaction ({{ accId }})</h3>
      <form [formGroup]="txnForm" (ngSubmit)="recordTransaction()">
        <div class="grid narrow">
          <label>
            Type
            <select formControlName="type" (change)="onTxnTypeChange()">
              <option value="DEPOSIT">Deposit</option>
              <option value="WITHDRAWAL">Withdrawal</option>
              <option value="TRANSFER">Transfer</option>
            </select>
          </label>

          <label>
            Amount
            <input type="number" formControlName="amount" min="0.01" step="0.01" />
          </label>

          <label *ngIf="txnForm.value.type==='TRANSFER'">
            To Account ID
            <select formControlName="toAccountId">
              <option [ngValue]="undefined">— Select —</option>
              <option *ngFor="let a of accounts" [ngValue]="a.accountId" [disabled]="a.accountId===selectedHistoryAccountId">
                {{ a.accountId }} — {{ a.customerName }}
              </option>
            </select>
          </label>

          <label>
            Narrative (optional)
            <input type="text" formControlName="narrative" maxlength="140" placeholder="e.g., Salary credit / ATM withdrawal" />
          </label>
        </div>

        <div class="actions">
          <button class="primary" type="submit" [disabled]="txnForm.invalid || !selectedHistoryAccountId">Record</button>
          <button class="secondary" type="button" (click)="resetTxnForm()">Reset</button>
        </div>
        <small class="muted">Closed accounts cannot receive transactions. Withdrawals/transfers require sufficient balance.</small>
      </form>
    </div>

    <!-- History Table -->
    <div class="table-wrap" *ngIf="selectedHistoryAccountId && transactionsFor(selectedHistoryAccountId).length; else noTxns">
      <table>
        <thead>
          <tr>
            <th>Time</th>
            <th>Type</th>
            <th>Amount</th>
            <th>From</th>
            <th>To</th>
            <th>Flagged</th>
            <th>Narrative</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of transactionsFor(selectedHistoryAccountId)">
            <td>{{ t.time | date:'medium' }}</td>
            <td>{{ t.type }}</td>
            <td [class.red]="t.type==='WITHDRAWAL' || (t.type==='TRANSFER' && t.accountId===selectedHistoryAccountId)">
              {{ t.amount | number:'1.2-2' }}
            </td>
            <td>{{ t.accountId }}</td>
            <td>{{ t.toAccountId || '—' }}</td>
            <td>
              <span class="pill" [class.ok]="t.flagged" [class.bad]="!t.flagged">
                {{ t.flagged ? 'HIGH' : 'Normal' }}
              </span>
            </td>
            <td>{{ t.narrative || '—' }}</td>
            <td>
              <button class="link" (click)="flagTransaction(t)" [disabled]="t.flagged">Flag</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #noTxns>
      <p class="muted" *ngIf="selectedHistoryAccountId">No transactions yet for {{ selectedHistoryAccountId }}.</p>
      <p class="muted" *ngIf="!selectedHistoryAccountId">Select an account to view history.</p>
    </ng-template>
  </div>
</section>
