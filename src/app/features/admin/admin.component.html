 
<!-- Admin Console Page -->
<div class="admin-page">
  <!-- ===== Header (converted to officer-style navbar for visual parity) ===== -->
  <nav class="navbar navbar-expand-lg fixed-top" role="navigation" aria-label="Admin Primary">
    <div class="container-fluid d-flex align-items-center justify-content-between">
       <div class="d-flex align-items-center gap-3">
        <a class="navbar-brand d-flex align-items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" class="bi bi-bank me-2 bank-logo" viewBox="0 0 16 16" aria-hidden="true">
            <path fill="#ffffff" d="M8 .95l6.364 3.182v1.09H1.636v-1.09L8 .95zm0 1.09L2.636 5.223h10.728L8 2.04zM1 6h14v1H1V6zm1 2h1v6H2V8zm2 0h1v6H4V8zm2 0h1v6H6V8zm2 0h1v6H8V8zm2 0h1v6h-1V8zm2 0h1v6h-1V8zm2 0h1v6h-1V8z"></path>
          </svg>
          <span class="text-white fw-bold">Admin Console</span>
        </a>
      </div>

      <div class="d-flex align-items-center gap-2">
        <!-- Toggle Admin/Compliance (keeps original behaviour) -->
        <button *ngIf="activeView === 'admin'; else backToAdminBtn" class="btn btn-glass btn-sm" type="button" (click)="showCompliance()" title="Open Compliance Dashboard">Dashboard</button>
        <ng-template #backToAdminBtn>
          <button class="btn btn-glass btn-sm" type="button" (click)="showAdmin()" title="Back to Admin Console">Back to Admin</button>
        </ng-template>

        <!-- Existing Users button -->
        <button *ngIf="!(activeView === 'admin' && showExistingOnly); else backToFull" class="btn btn-glass btn-sm" type="button" (click)="openExistingUsers()" title="Show only Existing Users">Existing Users</button>
        <ng-template #backToFull>
          <button class="btn btn-glass btn-sm" type="button" (click)="showFullAdmin()" title="Back to full Admin">Back to Admin</button>
        </ng-template>

        <!-- Profile Section (solid white avatar matching officer) -->
        <div class="profile-section position-relative ms-3" *ngIf="currentUser">
          <button class="btn btn-light btn-circle profile-btn profile-avatar-sm" type="button" id="headerProfileDropdown" aria-expanded="false" (click)="toggleProfileMenu()">
            <span class="initials">{{ initials(currentUser.name) }}</span>
          </button>

          <!-- Profile Dropdown -->
          <div *ngIf="isProfileMenuOpen" class="dropdown-menu show animate-slideDown p-0 profile-dropdown profile-dropdown-menu">
            <!-- Profile Header -->
            <div class="card-gradient-header p-3 d-flex gap-3 border-0">
              <div class="btn btn-light btn-circle flex-center flex-shrink-0 profile-avatar-lg">
                <span class="initials">{{ initials(currentUser.name) }}</span>
              </div>
              <div class="flex-grow-1">
                <div class="profile-name text-white fw-bold mb-1">{{ currentUser.name }}</div>
                <div class="profile-designation profile-designation-text">{{ currentUser.role }}</div>
              </div>
            </div>

            <div class="dropdown-divider m-0"></div>

            <!-- Dropdown Items -->
            <button class="dropdown-item" type="button" (click)="openProfile(); toggleProfileMenu()">
              <span class="item-icon">ðŸ‘¤</span>
              <span>View Profile</span>
            </button>
            <button class="dropdown-item border-top" type="button" (click)="signOut(); toggleProfileMenu()">
              <span class="item-icon">ðŸšª</span>
              <span>Sign out</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- spacer to offset fixed navbar height so content is not hidden behind it -->
  <div class="navbar-spacer"></div>

  <!-- Profile Sidebar Component -->
  <app-admin-profile *ngIf="showProfile" (close)="closeProfile()"></app-admin-profile>
 
  <!-- ===== ADMIN VIEW ===== -->
  <div *ngIf="activeView === 'admin'" class="dashboard-container">
    <!-- Normal Admin layout (hidden in Existing-only mode) -->
    <ng-container *ngIf="!showExistingOnly; else existingOnlyBlock">
 
      <!-- Welcome / Summary Card (shows logged-in user) - matches officer/manager styling -->
      <div class="welcome-card card-gradient-header mb-4">
        <div class="welcome-content">
          <h1 class="welcome-title">Welcome, {{ currentUser?.name || 'Admin' }}</h1>
          <p class="welcome-subtitle">{{ currentUser?.role || 'Administrator' }} â€¢ {{ currentUser?.branch || 'Headquarters' }}</p>
        </div>
      </div>

 
      <!-- Pending Approvals -->
      <div class="card mb-3 pending-approvals-card">
        <div class="card-header pending-header">
          <div class="d-flex align-items-center justify-content-between">
            <h2 class="h6 mb-0 pending-title">Pending Approvals</h2>
            <div class="small pending-count">
              Showing {{ getFilteredPendingUsers().length | number }} of {{ pendingUsers.length | number }} pending
            </div>
          </div>
        </div>
        <div class="search-container">
          <input
            type="text"
            class="form-control form-control-sm"
            placeholder="Search by User ID, Name, Email, Role, or Branch..."
            [(ngModel)]="pendingSearchTerm"
          />
          <button
            *ngIf="pendingSearchTerm"
            type="button"
            class="btn btn-sm btn-outline-light"
            (click)="clearPendingSearch()"
            title="Clear search"
          >
            âœ•
          </button>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-sm table-hover mb-0 align-middle pending-table">
              <thead class="pending-table-head">
                <tr>
                  <th>User ID</th>
                  <th>Name</th>
                  <th>Role</th>
                  <th>Email</th>
                  <th>Branch</th>
                  <th class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let u of getFilteredPendingUsers()">
                  <td>{{ u.userId }}</td>
                  <td>{{ u.name }}</td>
                  <td>{{ u.role }}</td>
                  <td class="text-truncate email-cell-truncate">{{ u.email }}</td>
                  <td>{{ u.branch }}</td>
                  <td class="text-end">
                    <!-- Glass button to open modal -->
                    <button
                      type="button"
                      class="btn btn-glass btn-sm"
                      (click)="openProceed(u)"
                      data-bs-toggle="modal"
                      data-bs-target="#proceedModal"
                    >
                      Proceed
                    </button>
                  </td>
                </tr>
                <tr *ngIf="getFilteredPendingUsers().length === 0">
                  <td colspan="6" class="text-center text-muted py-3">No pending approvals</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </ng-container>
 
    <!-- Existing-only mode: ONLY show the child component -->
    <ng-template #existingOnlyBlock>
      <app-existing-users-table
        [rows]="existingUsers()"
        (selectUser)="onExistingUserSelected($event)"
        (updateUser)="onExistingUserUpdated($event)"
      ></app-existing-users-table>
    </ng-template>
  </div>
 
  <!-- ===== COMPLIANCE VIEW ===== -->
  <div *ngIf="activeView === 'compliance'" class="compliance-root">
    <!-- Compliance KPIs -->
    <div class="card mb-3">
     
      <div class="card-body">
        <div class="row g-3 mb-3 kpis-row">
          <div class="col-12 col-md-4">
            <div class="p-3 border rounded-3 kpi h-100 d-flex flex-column justify-content-between">
              <div class="text-muted small">Total Transactions</div>
              <div class="fs-5 fw-semibold text-dark">{{ compliance.totalTransactions | number }}</div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="p-3 border rounded-3 kpi h-100 d-flex flex-column justify-content-between">
              <div class="text-muted small">High-Value Count</div>
              <div class="fs-5 fw-semibold text-dark">{{ compliance.highValueCount | number }}</div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="p-3 border rounded-3 kpi h-100 d-flex flex-column justify-content-between">
              <div class="text-muted small">Account Growth Rate</div>
              <div class="fs-5 fw-semibold text-dark">{{ compliance.accountGrowthRate | number:'1.0-2' }}%</div>
            </div>
          </div>
        </div>
 
        <!-- Dual line chart -->
        <div class="chart-block mb-3">
          <div class="container-fluid px-3 px-md-4">
            <div class="d-flex align-items-center justify-content-between mb-2 flex-wrap">
              <h3 class="h6 mb-2 mb-md-0">Monthly Volume vs Suspicious Flags</h3>
              <div class="legend small text-muted d-flex align-items-center gap-3">
                <span class="d-inline-flex align-items-center gap-1">
                  <span class="swatch swatch-primary"></span> Transactions
                </span>
                <span class="d-inline-flex align-items-center gap-1">
                  <span class="swatch swatch-danger"></span> Suspicious
                </span>
              </div>
            </div>
 
            <!-- Chart wrapper reference -->
            <div class="svg-wrap" #chartWrap>
              <svg
                class="svg-chart"
                role="img"
                aria-label="Monthly volume and suspicious"
                [attr.viewBox]="'0 0 ' + chartWidth + ' ' + chartHeight"
                preserveAspectRatio="xMidYMid meet"
              >
                <!-- Y axis ticks & grid -->
                <g class="y-axis" *ngIf="compliance.monthlyTxnVolume.length">
                  <g *ngFor="let t of yTicks()">
                    <line
                      [attr.x1]="chartLeftMargin"
                      [attr.y1]="yPosInPlot(t, chartHeight - 60)"
                      [attr.x2]="chartLeftMargin + plotWidth()"
                      [attr.y2]="yPosInPlot(t, chartHeight - 60)"
                      stroke="rgba(0,0,0,0.06)"
                    />
                    <text
                      [attr.x]="chartLeftMargin - 8"
                      [attr.y]="yPosInPlot(t, chartHeight - 60) + 4"
                      text-anchor="end"
                      font-size="11"
                    >
                      {{ t | number }}
                    </text>
                  </g>
                </g>
 
                <!-- Move plot area right to make room for Y axis labels -->
                <g [attr.transform]="'translate(' + chartLeftMargin + ',0)'">
                  <!-- baseline -->
                  <line [attr.x1]="0" [attr.y1]="chartHeight - 60" [attr.x2]="plotWidth()" [attr.y2]="chartHeight - 60" stroke="#cfd8dc" />
 
                  <!-- series -->
                  <path [attr.d]="linePath(compliance.monthlyTxnVolume, plotWidth(), chartHeight - 60)" fill="none" stroke="#1976d2" stroke-width="2"></path>
 
                  <path [attr.d]="linePath(compliance.monthlySuspicious, plotWidth(), chartHeight - 60)" fill="none" stroke="#d32f2f" stroke-width="2" stroke-dasharray="4 3"></path>
 
                  <!-- x-axis labels -->
                  <g class="x-labels text-dark">
                    <text
                      *ngFor="let lbl of compliance.monthlyLabels; let i = index"
                      [attr.x]="(plotWidth() / (compliance.monthlyLabels.length - 1)) * i"
                      [attr.y]="chartHeight - 25"
                      text-anchor="middle"
                      font-size="12"
                    >
                      {{ lbl }}
                    </text>
                  </g>
                </g>
              </svg>
            </div>
          </div>
        </div>
 
        <!-- Amount Buckets -->
        <div class="chart-block mb-3">
          <h3 class="h6 mb-2">Amount Buckets</h3>
          <div class="bars">
            <div class="bar-row" *ngFor="let b of compliance.amountBuckets">
              <div class="bar-label">{{ b.label }}</div>
              <div class="bar-track">
                <div class="bar-fill" [style.width.%]="bucketPercent(b.count)"></div>
              </div>
              <div class="bar-value text-white">{{ b.count | number }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
 
  <!-- ===== Proceed Modal (for Pending Approvals) ===== -->
  <div
    class="modal fade glass-modal"
    id="proceedModal"
    tabindex="-1"
    aria-labelledby="proceedModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content text-white">
        <div class="modal-header">
          <h5 class="modal-title" id="proceedModalLabel">
            Proceed: {{ pendingSelectedUser?.name || 'User' }}
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
 
        <div class="modal-body">
          <ng-container *ngIf="pendingSelectedUser; else noPendingUser">
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <div class="text-muted small">User ID</div>
                <div class="fw-semibold text-dark">{{ pendingSelectedUser.userId }}</div>
              </div>
              <div class="col-12 col-md-6">
                <div class="text-muted small">Name</div>
                <div class="fw-semibold text-dark">{{ pendingSelectedUser.name }}</div>
              </div>
              <div class="col-12 col-md-6">
                <div class="text-muted small">Email</div>
                <div class="fw-semibold text-dark">{{ pendingSelectedUser.email }}</div>
              </div>
              <div class="col-12 col-md-6">
                <div class="text-muted small">Branch</div>
                <div class="fw-semibold text-dark">{{ pendingSelectedUser.branch }}</div>
              </div>
              <div class="col-12 col-md-6">
                <div class="text-muted small">Role</div>
                <div class="fw-semibold text-dark">{{ pendingSelectedUser.role }}</div>
              </div>
              <div class="col-12 col-md-6">
                <div class="text-muted small">Status</div>
                <span
                  class="badge"
                  [ngClass]="{
                    'bg-success-subtle text-success border border-success': pendingSelectedUser.status === 'Active',
                    'bg-danger-subtle text-danger border border-danger': pendingSelectedUser.status === 'Inactive',
                    'bg-warning-subtle text-warning border border-warning': pendingSelectedUser.status === 'Pending'
                  }"
                >
                  {{ pendingSelectedUser.status }}
                </span>
              </div>
            </div>
          </ng-container>
          <ng-template #noPendingUser>
            <div class="text-muted">No user selected.</div>
          </ng-template>
        </div>
 
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-success" data-bs-dismiss="modal">Close</button>
          <button
            type="button"
            class="btn btn-outline-danger"
            (click)="rejectUser(pendingSelectedUser!)"
            data-bs-dismiss="modal"
          >
            Reject
          </button>
          <button
            type="button"
            class="btn btn-primary"
            (click)="approveUser(pendingSelectedUser!)"
            data-bs-dismiss="modal"
          >
            Approve
          </button>
        </div>
      </div>
    </div>
  </div>
 
  <!-- Edit User Modal -->
  <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="editUserModalLabel">Edit User</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" *ngIf="editingUser">
          <form [formGroup]="editUserForm" (ngSubmit)="saveEditedUser()">
            <div class="mb-3">
              <label for="editName" class="form-label">Name</label>
              <input id="editName" type="text" class="form-control" formControlName="name" />
              <div class="form-text text-danger" *ngIf="editUserForm.get('name')?.touched && editUserForm.get('name')?.invalid">
                Name is required
              </div>
            </div>
            <div class="mb-3">
              <label for="editEmail" class="form-label">Email</label>
              <input id="editEmail" type="email" class="form-control" formControlName="email" />
              <div class="form-text text-danger" *ngIf="editUserForm.get('email')?.touched && editUserForm.get('email')?.invalid">
                Valid email is required
              </div>
            </div>
            <div class="mb-3">
              <label for="editRole" class="form-label">Role</label>
              <select id="editRole" class="form-select" formControlName="role">
                <option value="Officer">Officer</option>
                <option value="Manager">Manager</option>
                <option value="Admin">Admin</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="editBranch" class="form-label">Branch</label>
              <input id="editBranch" type="text" class="form-control" formControlName="branch" />
              <div class="form-text text-danger" *ngIf="editUserForm.get('branch')?.touched && editUserForm.get('branch')?.invalid">
                Branch is required
              </div>
            </div>
            <div class="mb-3">
              <label for="editStatus" class="form-label">Status</label>
              <select id="editStatus" class="form-select" formControlName="status">
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
                <option value="Pending">Pending</option>
              </select>
            </div>
            <div class="d-flex gap-2 justify-content-end">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary" [disabled]="editUserForm.invalid">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
 
  <!-- Edit My Details Modal -->
  <div class="modal fade" id="editMyDetailsModal" tabindex="-1" aria-labelledby="editMyDetailsLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header modal-header-gradient">
          <h1 class="modal-title fs-5 text-white" id="editMyDetailsLabel">Edit My Details</h1>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="myDetailsForm" (ngSubmit)="submitDetailsChangeRequest()">
            <div class="mb-3">
              <label for="myName" class="form-label">Name</label>
              <input type="text" id="myName" class="form-control" formControlName="name" required />
              <small class="text-muted">Your full name</small>
            </div>
            <div class="mb-3">
              <label for="myEmail" class="form-label">Email</label>
              <input type="email" id="myEmail" class="form-control" formControlName="email" required />
              <small class="text-muted">Your contact email</small>
            </div>
            <div class="mb-3">
              <label for="myPhone" class="form-label">Phone (Optional)</label>
              <input type="tel" id="myPhone" class="form-control" formControlName="phone" />
              <small class="text-muted">Your contact number</small>
            </div>
            <div class="mb-3">
              <label for="myAddress" class="form-label">Address (Optional)</label>
              <textarea id="myAddress" class="form-control" formControlName="address" rows="3"></textarea>
              <small class="text-muted">Your address</small>
            </div>
            <div class="alert alert-info">
              <strong>Note:</strong> Your changes will be sent for admin approval. You'll be notified once approved or rejected.
            </div>
            <div class="d-flex gap-2 justify-content-end">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary" [disabled]="myDetailsForm.invalid">
                Send Request
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
 
  <!-- Footer (optional) -->
</div>
 
<!-- Optional small styles (component-scoped if using Angular's styles) -->
<style>
  .dropdown-menu.text-sm { font-size: 0.9rem; }
  .avatar-initials { font-weight: 600; letter-spacing: 0.5px; }
  .swatch { display:inline-block; width:12px; height:12px; border-radius:2px; }
  .btn-transparent { background: transparent; border: 0; color: inherit; }
</style>
