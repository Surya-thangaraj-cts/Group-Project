<div class="card">
  <h2>Alerts</h2>
  <p class="helper">Notifications for account updates and high-value transactions.</p>
 
  <!-- Filters + Search -->
  <div class="grid-narrow mt-2">
    <label class="full">
      Search (Account #)
      <div class="search-group">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange($event)"
          (keyup.enter)="onSearchSubmit()"
          [ngModelOptions]="{standalone:true}"
          placeholder="Enter account number..."
          aria-label="Search by account number">
        <button type="button" class="secondary btn-sm search-btn" (click)="onSearchSubmit()">Search</button>
        <button type="button" class="ghost btn-sm search-btn" *ngIf="searchTerm" (click)="clearSearch()">Clear</button>
      </div>
    </label>
 
    <label>
      Read status
      <select
        class="select-compact"
        [ngModel]="readFilter"
        (ngModelChange)="onReadFilterChange($event)"
        [ngModelOptions]="{standalone:true}">
        <option value="ALL">All</option>
        <option value="UNREAD">Unread</option>
        <option value="READ">Read</option>
      </select>
    </label>
 
    <label>
      Type
      <select
        class="select-compact"
        [ngModel]="typeFilter"
        (ngModelChange)="onTypeFilterChange($event)"
        [ngModelOptions]="{standalone:true}">
        <option value="ALL">All</option>
        <option value="UPDATE_REQUEST">Update Request</option>
        <option value="HIGH_VALUE_TXN">High-value Transaction</option>
      </select>
    </label>
 
    <div class="actions">
      <button class="secondary btn-sm" type="button" (click)="markAllAsRead()">Mark all as read</button>
      <button class="danger btn-sm" type="button" (click)="clearAll()">Delete all</button>
    </div>
  </div>
 
  <br>
 
  <!-- Notification Cards + Pagination -->
  <ng-container *ngIf="vm$ | async as vm">
    <div class="notif-list" *ngIf="vm.total > 0; else noAlerts">
      <article class="notif-card" [class.unread]="!n.read" *ngFor="let n of vm.pageData; trackBy: trackById">
        <header class="notif-header">
          <div class="left">
            <span class="pill" [class.ok]="!n.read" [class.bad]="n.read">
              {{ typeLabel(n.type) }}
            </span>
 
            <!-- Default status for Update Requests & High-value Txn -->
            <span class="status-pill pending" *ngIf="statusLabelFor(n) as s">
              {{ s }}
            </span>
          </div>
 
          <div class="right">
            <span class="muted">{{ n.time | date:'medium' }}</span>
          </div>
        </header>
 
        <h3 class="notif-title">{{ n.title }}</h3>
 
        <!-- Message -->
        <p class="notif-message">
          {{ n.message }}
        </p>
 
        <!-- "Update request sent for account number" style line -->
        <p class="notif-cta" *ngIf="n.type === 'UPDATE_REQUEST'">
          Update request sent for <strong>Account #</strong>
          <strong>{{ n.meta?.accountId || '—' }}</strong>
        </p>
 
        <!-- Meta grid -->
        <div class="notif-meta">
          <div class="kv">
            <span class="label">Account #</span>
            <span class="value">{{ n.meta?.accountId || '—' }}</span>
          </div>
 
          <div class="kv" *ngIf="n.meta?.amount">
            <span class="label">Amount</span>
            <span class="value">{{ n.meta?.amount | currency:'INR':'symbol-narrow' }}</span>
          </div>
 
          <div class="kv" *ngIf="n.meta?.txnId">
            <span class="label">Txn ID</span>
            <span class="value">{{ n.meta?.txnId }}</span>
          </div>
 
          <div class="kv" *ngIf="n.meta?.toAccountId">
            <span class="label">To Account</span>
            <span class="value">{{ n.meta?.toAccountId }}</span>
          </div>
        </div>
 
        <!-- Actions -->
        <div class="notif-actions actions">
          <ng-container [ngSwitch]="n.type">
            <a *ngSwitchCase="'UPDATE_REQUEST'"
               class="link"
               [routerLink]="['/officer/update']"
               [queryParams]="{ accountId: n.meta?.accountId }">
              View Update
            </a>
            <a *ngSwitchDefault
               class="link"
               [routerLink]="['/officer/history']">
              View History
            </a>
          </ng-container>
 
          <span class="spacer"></span>
 
          <button class="primary btn-sm" type="button" *ngIf="!n.read" (click)="markAsRead(n.id)">Mark read</button>
          <button class="secondary btn-sm" type="button" *ngIf="n.read" (click)="markAsUnread(n.id)">Mark unread</button>
          <button class="danger btn-sm" type="button" (click)="delete(n.id)">Delete</button>
        </div>
      </article>
 
      <!-- Pagination -->
      <div class="actions table-actions">
        <div class="inline">
          <span class="muted">Rows per page</span>
          <select
            class="select-compact"
            [value]="vm.pageSize"
            (change)="onPageSizeChange($event)"
            aria-label="Rows per page">
            <option *ngFor="let s of pageSizeOptions" [value]="s">{{ s }}</option>
          </select>
        </div>
 
        <div class="muted range-text">{{ vm.from }}–{{ vm.to }} of {{ vm.total }}</div>
 
        <div class="pager">
          <button type="button" class="pager-btn" (click)="setPage(1)" [disabled]="vm.currentPage===1" aria-label="First page">First</button>
          <button type="button" class="pager-btn" (click)="prevPage()" [disabled]="vm.currentPage===1" aria-label="Previous page">Prev</button>
 
          <ng-container *ngFor="let p of vm.pages">
            <button type="button" class="pager-btn"
                    (click)="setPage(p)"
                    [class.active]="p===vm.currentPage"
                    [attr.aria-current]="p===vm.currentPage ? 'page' : null"
                    [attr.aria-label]="'Go to page ' + p">
              {{ p }}
            </button>
          </ng-container>
 
          <button type="button" class="pager-btn" (click)="nextPage()" [disabled]="vm.currentPage===vm.totalPages" aria-label="Next page">Next</button>
          <button type="button" class="pager-btn" (click)="setPage(vm.totalPages)" [disabled]="vm.currentPage===vm.totalPages" aria-label="Last page">Last</button>
        </div>
      </div>
    </div>
  </ng-container>
 
  <ng-template #noAlerts>
    <p class="muted">No alerts yet.</p>
  </ng-template>
</div>
 