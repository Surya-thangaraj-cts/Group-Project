<!-- src/app/features/officer/create-account/create-account.component.html -->
<div class="card">
  <header class="card-header"><h2>Create Bank Account</h2></header>

  <form [formGroup]="createForm" (ngSubmit)="createAccount()" class="responsive-form" novalidate>
    <div class="grid">
      <label>
        Account ID
        <input type="text" formControlName="accountId" placeholder="Enter Account ID" />
        <div class="error" *ngIf="createForm.get('accountId')?.invalid && (createForm.get('accountId')?.touched || submitted)">
          <small *ngIf="createForm.get('accountId')?.errors?.['required']" class="err-text">Account ID is required!</small>
          <small *ngIf="createForm.get('accountId')?.errors?.['minlength']" class="err-text">Account ID must be at least 3 characters!</small>
        </div>
      </label>

      <label>
        Customer Name
        <input type="text" formControlName="customerName" placeholder="Enter Customer Name" />
        <div class="error" *ngIf="createForm.get('customerName')?.invalid && (createForm.get('customerName')?.touched || submitted)">
          <small *ngIf="createForm.get('customerName')?.errors?.['required']" class="err-text">Customer Name is required!</small>
        </div>
      </label>

      <label>
        Customer ID
        <input type="text" formControlName="customerId" placeholder="Enter Customer ID" />
        <div class="error" *ngIf="createForm.get('customerId')?.invalid && (createForm.get('customerId')?.touched || submitted)">
          <small *ngIf="createForm.get('customerId')?.errors?.['required']" class="err-text">Customer ID is required!</small>
        </div>
      </label>

      <label>
        Account Type
        <select formControlName="accountType">
          <option value="SAVINGS">Savings</option>
          <option value="CURRENT">Current</option>
        </select>
        <div class="error" *ngIf="createForm.get('accountType')?.invalid && (createForm.get('accountType')?.touched || submitted)">
          <small *ngIf="createForm.get('accountType')?.errors?.['required']" class="err-text">Account Type is required!</small>
        </div>
      </label>
    </div>

    <br />

    <div class="actions">
      <button class="primary" type="submit">Create Account</button>
      <button type="button" class="secondary" (click)="createForm.reset(defaultCreateForm()); submitted=false">
        Reset
      </button>
    </div>

    <div class="helper" *ngIf="submitted && createForm.invalid">
      <small>There are errors above. Please fix them to continue.</small>
    </div>
  </form>

  <hr />

  <!-- Existing Accounts section -->
  <ng-container *ngIf="vm$ | async as vm">
    <div class="section-header">
      <h3>Existing Accounts ({{ vm.total }})</h3>

      <!-- Filters bar -->
      <div class="filters-bar">
        <!-- Compact search -->
        <div class="accounts-search">
          <input
            type="text"
            class="accounts-search-input"
            [ngModel]="searchTerm"
            (ngModelChange)="onSearchChange($event)"
            (keyup.enter)="onSearchSubmit()"
            [ngModelOptions]="{standalone:true}"
            placeholder="Search account or customer"
            aria-label="Search accounts" />

          <button type="button" class="accounts-search-btn" (click)="onSearchSubmit()">Search</button>
          <button type="button" class="accounts-search-btn ghost" *ngIf="searchTerm" (click)="clearSearch()">Clear</button>
        </div>

        <!-- Status filter -->
        <div class="accounts-status">
          <select
            class="accounts-status-select"
            [ngModel]="statusFilter"
            (ngModelChange)="onStatusFilterChange($event)"
            [ngModelOptions]="{standalone:true}">
            <option value="ALL">All</option>
            <option value="ACTIVE">Active</option>
            <option value="INACTIVE">Inactive</option>
          </select>
        </div>
      </div>
    </div>

    <div class="table-wrap" *ngIf="vm.total > 0; else noAccountsCreate">
      <table>
        <thead>
          <tr>
            <th>Account ID</th>
            <th>Customer Name</th>
            <th>Customer ID</th>
            <th>Type</th>
            <th>Status</th>
            <th>Opened</th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let a of vm.pageData; trackBy: trackByAccountId">
            <td>{{ a.accountId }}</td>
            <td>{{ a.customerName }}</td>
            <td>{{ a.customerId }}</td>
            <td>{{ a.accountType }}</td>
            <td>
              <span class="pill" [class.ok]="a.status==='ACTIVE'" [class.bad]="a.status==='CLOSED'">
                {{ a.status === 'ACTIVE' ? 'ACTIVE' : 'INACTIVE' }}
              </span>
            </td>
            <td>{{ a.openedAt | date:'medium' }}</td>
            <td>
              <button class="link" (click)="prefillUpdate(a.accountId)">Edit</button>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Pagination -->
      <div class="actions pagination-bar">
        <div class="inline">
          <span class="muted">Rows per page</span>
          <select class="select-compact" [value]="vm.pageSize" (change)="onPageSizeChange($event)">
            <option *ngFor="let s of pageSizeOptions" [value]="s">{{ s }}</option>
          </select>
        </div>

        <div class="muted">
          {{ vm.from }}â€“{{ vm.to }} of {{ vm.total }}
        </div>

        <div class="pager">
          <button class="pager-btn" (click)="setPage(1)" [disabled]="vm.currentPage===1">First</button>
          <button class="pager-btn" (click)="prevPage()" [disabled]="vm.currentPage===1">Prev</button>

          <button class="pager-btn" *ngFor="let p of vm.pages"
                  (click)="setPage(p)"
                  [ngClass]="{'active': p===vm.currentPage}">
            {{ p }}
          </button>

          <button class="pager-btn" (click)="nextPage()" [disabled]="vm.currentPage===vm.totalPages">Next</button>
          <button class="pager-btn" (click)="setPage(vm.totalPages)" [disabled]="vm.currentPage===vm.totalPages">Last</button>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-template #noAccountsCreate>
    <p class="muted">No accounts yet. Create one using the form above.</p>
  </ng-template>
</div>