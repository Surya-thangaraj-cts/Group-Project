 
<div class="card m-3 existing-users-card">
  <div class="card-header existing-users-header">
    <div class="d-flex align-items-center justify-content-between">
      <div>
        <h2 class="existing-users-title">Existing Users</h2>
        <p class="existing-users-subtitle">Manage and view all registered users</p>
      </div>
      <div class="existing-users-count">
        <span class="count-number">{{ getFilteredRows().length }}</span>
        <span class="count-label">of {{ rows.length }}</span>
      </div>
    </div>
  </div>

  <div class="card-search-section">
    <div class="search-container">
      <input
        type="text"
        class="form-control form-control-sm"
        placeholder="Search by User ID, Name, Email, Role, Branch, or Status..."
        [(ngModel)]="searchTerm"
        />
      <button
        *ngIf="searchTerm"
        type="button"
        class="btn btn-sm btn-outline-light"
        (click)="clearSearch()"
        title="Clear search"
        >
        ✕
      </button>
    </div>
  </div>

  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-sm table-hover mb-0 align-middle existing-users-table">
        <thead class="existing-users-thead">
          <tr>
            <th class="col-user-id">User ID</th>
            <th class="col-name">Name</th>
            <th class="col-role">Role</th>
            <th class="col-email">Email</th>
            <th class="col-branch">Branch</th>
            <th class="col-status">Status</th>
            <th class="text-end col-actions">Actions</th>
          </tr>
        </thead>
 
        <tbody>
          <tr *ngFor="let u of getFilteredRows(); trackBy: trackByUserId">
            <!-- Non-editing row -->
            <ng-container *ngIf="editingUserId !== u.userId; else editRow">
              <td (click)="selectUser.emit(u)" style="cursor:pointer">{{ u.userId }}</td>
              <td (click)="selectUser.emit(u)" style="cursor:pointer">{{ u.name }}</td>
              <td (click)="selectUser.emit(u)" style="cursor:pointer">{{ u.role }}</td>
              <td (click)="selectUser.emit(u)" class="text-truncate" style="max-width:280px; cursor:pointer;">
                {{ u.email }}
              </td>
              <td (click)="selectUser.emit(u)" style="cursor:pointer">{{ u.branch }}</td>
              <td>
                <span
                  class="badge"
                  [ngClass]="{
                    'bg-success-subtle text-success border border-success': u.status === 'Active',
                    'bg-danger-subtle text-danger border border-danger': u.status === 'Inactive',
                    'bg-warning-subtle text-warning border border-warning': u.status === 'Pending'
                  }"
                >
                  {{ u.status }}
                </span>
              </td>
              <td class="text-end">
                <button type="button" class="btn btn-edit btn-sm" (click)="startEdit(u)" title="Edit user">
                  <span class="edit-icon">✎</span>
                  <span class="edit-text">Edit</span>
                </button>
              </td>
            </ng-container>
 
            <!-- Editing row -->
            <ng-template #editRow>
              <td>{{ u.userId }}</td>
              <td colspan="5">
                <form [formGroup]="editForm" (ngSubmit)="saveEdit(u)" >
                  <div class="row g-2">
                    <div class="col-md-4">
                      <label class="form-label">Name</label>
                      <input type="text" class="form-control form-control-sm" formControlName="name"/>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Email</label>
                      <input type="email" class="form-control form-control-sm" formControlName="email" />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Role</label>
                      <select class="form-select form-select-sm" formControlName="role">
                        <option value="Officer">Officer</option>
                        <option value="Manager">Manager</option>
                        <option value="Admin">Admin</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Branch</label>
                      <input type="text" class="form-control form-control-sm" formControlName="branch" />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Status</label>
                      <select class="form-select form-select-sm" formControlName="status">
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                      </select>
                    </div>
                  </div>

                  <div class="mt-3 d-flex gap-2 edit-actions">
                    <button type="submit" class="btn btn-save btn-sm" [disabled]="editForm.invalid">
                      <span class="save-icon">✓</span>
                      Save
                    </button>
                    <button type="button" class="btn btn-cancel btn-sm" (click)="cancelEdit()">
                      <span class="cancel-icon">✕</span>
                      Cancel
                    </button>
                  </div>
                </form>
              </td>
              <td></td>
            </ng-template>
          </tr>
 
          <tr *ngIf="getFilteredRows().length === 0">
            <td colspan="7" class="text-center text-muted py-3">No existing users</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
 
 